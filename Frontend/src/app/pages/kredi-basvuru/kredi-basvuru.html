<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h3 class="card-title text-center text-primary mb-4">
            <i class="bi bi-credit-card-fill me-2"></i>
            Kredi BaÅŸvurusu
          </h3>

          <form [formGroup]="basvuruForm" (ngSubmit)="submitForm()">
            <!-- Ad Soyad -->
            <div class="mb-3">
              <label class="form-label">Ad Soyad</label>
              <input
                type="text"
                formControlName="fullName"
                class="form-control"
                [class.is-invalid]="
                  submitted && basvuruForm.get('fullName')?.invalid
                "
              />
              <div class="invalid-feedback">Ad - Soyad zorunludur</div>
            </div>

            <!-- Email -->
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input
                type="email"
                formControlName="email"
                class="form-control"
                [class.is-invalid]="
                  submitted && basvuruForm.get('email')?.invalid
                "
              />
              <div class="invalid-feedback">E-mail bilgisi zorunludur</div>
            </div>
            <!-- Telefon NumarasÄ± -->
            <div class="mb-3">
              <label class="form-label">Telefon NumarasÄ±</label>
              <input
                type="text"
                formControlName="phoneNumber"
                class="form-control"
                [class.is-invalid]="
                  submitted && basvuruForm.get('phoneNumber')?.invalid
                "
              />
              <div
                class="invalid-feedback"
                *ngIf="submitted && basvuruForm.get('phoneNumber')?.errors"
              >
                <div
                  *ngIf="basvuruForm.get('phoneNumber')?.errors?.['required']"
                >
                  Telefon numarasÄ± zorunludur
                </div>
                <div
                  *ngIf="basvuruForm.get('phoneNumber')?.errors?.['pattern']"
                >
                  GeÃ§erli bir telefon numarasÄ± giriniz (sadece rakam)
                </div>
              </div>
            </div>

            <!-- Banka AdÄ± -->
            <div class="mb-3">
              <label class="form-label">Banka AdÄ±</label>
              <select
                formControlName="bankName"
                class="form-select"
                [class.is-invalid]="
                  submitted && basvuruForm.get('bankName')?.invalid
                "
              >
                <option value="">Banka SeÃ§iniz</option>
                <option *ngFor="let banka of bankalar" [value]="banka.name">
                  {{ banka.name }}
                </option>
              </select>
              <div class="invalid-feedback">Banka SeÃ§imi Zorunludur</div>
            </div>

            <!-- Kredi Tipi -->
            <div class="mb-3">
              <label class="form-label">Kredi TÃ¼rÃ¼</label>
              <select
                formControlName="creditType"
                class="form-select"
                [class.is-invalid]="
                  submitted && basvuruForm.get('creditType')?.invalid
                "
              >
                <option value="">SeÃ§iniz</option>
                <option *ngFor="let c of creditTypes" [value]="c.value">
                  {{ c.label }}
                </option>
              </select>

              <div class="invalid-feedback">Kredi Tipi Zorunludur</div>
            </div>

            <!-- Kampanya -->

            <label class="form-label">Kampanya</label>
            <select
              class="form-select"
              formControlName="campaignId"
              (change)="kampanyaDegisti($event)"
              [class.is-invalid]="
                submitted && basvuruForm.get('campaignId')?.invalid
              "
            >
              <option value="">Kampanya SeÃ§iniz</option>
              <option
                *ngFor="let kampanya of kampanyalar"
                [value]="kampanya.id"
              >
                {{ kampanya.description }} - %{{ kampanya.faizOrani }}
              </option>
            </select>
            <div class="invalid-feedback">Kampanya seÃ§imi zorunludur</div>

            <!-- Kampanya Bilgi Kutusu -->
            <div *ngIf="selectedCampaign" class="alert alert-info small">
              <strong>Kampanya Detay:</strong><br />
              Faiz OranÄ±: %{{ selectedCampaign.faizOrani }}<br />
              Tutar AralÄ±ÄŸÄ±: {{ selectedCampaign.minKrediTutar }} â‚º â€“
              {{ selectedCampaign.maxKrediTutar }} â‚º<br />
              Vade AralÄ±ÄŸÄ±: {{ selectedCampaign.minVade }} â€“
              {{ selectedCampaign.maxVade }} ay<br />
              GeÃ§erlilik:
              {{ selectedCampaign.baslangicTarihi | date : "shortDate" }} -
              {{ selectedCampaign.bitisTarihi | date : "shortDate" }}
            </div>

          <!-- Kredi TutarÄ± -->
<div class="mb-3">
  <label class="form-label">Kredi TutarÄ±</label>
  <div class="d-flex gap-2 align-items-center">
    <input
      type="range"
      class="form-range flex-grow-1"
      formControlName="creditAmount"
      [min]="selectedCampaign?.minKrediTutar"
      [max]="selectedCampaign?.maxKrediTutar"
      step="1000"
    />
    <input
      type="number"
      class="form-control"
      style="width: 140px"
      [min]="selectedCampaign?.minKrediTutar"
      [max]="selectedCampaign?.maxKrediTutar"
      step="1000"
      [value]="basvuruForm.get('creditAmount')?.value"
      (input)="syncCreditAmount($event)"
    />
  </div>
  <small class="text-muted">SeÃ§ilen Tutar: {{ basvuruForm.value.creditAmount | number }} â‚º</small>
</div>


            <!-- Vade Range -->

        <!-- Vade -->
<div class="mb-3">
  <label class="form-label">Vade (Ay)</label>
  <div class="d-flex gap-2 align-items-center">
    <input
      type="range"
      class="form-range flex-grow-1"
      formControlName="creditTerm"
      [min]="selectedCampaign?.minVade"
      [max]="selectedCampaign?.maxVade"
      step="1"
    />
    <input
      type="number"
      class="form-control"
      style="width: 100px"
      [min]="selectedCampaign?.minVade"
      [max]="selectedCampaign?.maxVade"
      step="1"
      [value]="basvuruForm.get('creditTerm')?.value"
      (input)="syncCreditTerm($event)"
    />
  </div>
  <small class="text-muted">SeÃ§ilen Vade: {{ basvuruForm.value.creditTerm }} Ay</small>
</div>

            <!-- AylÄ±k Gelir -->
            <div class="mb-3">
              <label class="form-label">AylÄ±k Gelir (â‚º)</label>
              <input
                type="number"
                formControlName="monthlyIncome"
                class="form-control"
                [class.is-invalid]="
                  submitted && basvuruForm.get('monthlyIncome')?.invalid
                "
              />
              <div
                class="invalid-feedback"
                *ngIf="submitted && basvuruForm.get('monthlyIncome')?.errors"
              >
                <div
                  *ngIf="basvuruForm.get('monthlyIncome')?.errors?.['required']"
                >
                  AylÄ±k gelir zorunludur
                </div>
                <div *ngIf="basvuruForm.get('monthlyIncome')?.errors?.['min']">
                  En az 1000 TL OlmalÄ±dÄ±r
                </div>
                <div *ngIf="basvuruForm.get('monthlyIncome')?.errors?.['max']">
                  En fazla 10.000.000 TL
                </div>
              </div>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary w-100">BaÅŸvur</button>
          </form>
          <!-- HESAPLAMA VE TAKSÄ°T PLANINI GÃ–STERME -->
<!-- Ã–deme PlanÄ±nÄ± GÃ¶ster Butonu -->
<div class="mt-4 text-center">
  <button class="btn btn-outline-primary" type="button" (click)="odemePlaniniGoster()">
    <i class="bi bi-calculator me-1"></i>
    Ã–deme PlanÄ±nÄ± GÃ¶ster
  </button>
</div>


<!-- HESAPLAMA SONUCU -->
<div *ngIf="hesaplamaSonucu" class="alert alert-info mt-4">
  <h5 class="text-primary"> Hesaplama Sonucu</h5>
  <p class="mb-0">
     <strong>AylÄ±k Taksit:</strong>
    {{ hesaplamaSonucu.monthlyPayment | number:'1.2-2' }} TL <br />
    <strong>Toplam Geri Ã–deme:</strong>
    {{ hesaplamaSonucu.totalPayment | number:'1.2-2' }} TL
  </p>
</div>

<!-- TAKSÄ°T TABLOSU -->
  <div *ngIf="hesaplamaSonucu" class="card mt-4 shadow-sm border-0">
  <h6 class="text-secondary">ğŸ§¾ Taksit Tablosu</h6>
  <div class="table-responsive">
    <table class="table table-sm table-bordered table-striped mt-2">
      <thead class="table-light">
        <tr>
          <th>Taksit No</th>
          <th>Taksit TutarÄ±</th>
          <th>Anapara</th>
          <th>Faiz</th>
          <th>Kalan Anapara</th>
        </tr>
      </thead>
      <tbody>
         <tr *ngFor="let t of hesaplamaSonucu.installments">
          <td>{{ t.installmentNo }}</td>
          <td>{{ t.payment | number:'1.2-2' }} TL</td>
          <td>{{ t.principal | number:'1.2-2' }} TL</td>
          <td>{{ t.interest | number:'1.2-2' }} TL</td>
          <td>{{ t.remainingPrincipal | number:'1.2-2' }} TL</td>
         </tr>
      </tbody>
    </table>
  </div>
</div>

        </div>
      </div>
    </div>
  </div>
</div>
